events {}

http {
    upstream admin-backend {
        server admin-service:8080;
    }

    upstream inventory-backend {
        server inventory-service:8081;
    }

    upstream products-backend {
        server product-catalog-service:8082;
    }

    upstream users-backend {
        server user-management-service:8083;
    }

    upstream orders-backend {
        server order-management-service:8084;
    }

    upstream data-access-backend {
        server data-access-service:8085;
    }

    server {
        listen 80;

        location /admin/ {
            proxy_pass http://admin-backend/;
        }

        location /inventory/ {
            proxy_pass http://inventory-backend/;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
        }

        # Updated location block for farmers endpoints
        location /farmers {
            proxy_pass http://inventory-backend;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
        }

        location /products/ {
            proxy_pass http://products-backend/;
        }

        location /users/ {
            proxy_pass http://users-backend/;
        }

        location /orders/ {
            proxy_pass http://orders-backend/;
        }

        location /data/ {
            proxy_pass http://data-access-backend/api/data/;
        }
    }
}
